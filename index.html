<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ÙˆÙƒØ§Ù„Ø© Ù†ÙˆØ± Ø§Ù„Ù…Ù†ØªØ¸Ø± - Ø¥Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Øµ</title>

<style>
body {
  margin: 0;
  padding: 0;
  background: #f2f4f7;
  font-family: "Tajawal", sans-serif;
}

.container {
  width: 90%;
  max-width: 430px;
  margin: 35px auto;
  background: white;
  padding: 25px;
  border-radius: 16px;
  box-shadow: 0 0 20px #0001;
  position: relative;
}

.title {
  text-align: center;
  font-size: 24px;
  margin-bottom: 5px;
  color: #333;
}

.subtitle {
  text-align: center;
  font-size: 14px;
  margin-bottom: 25px;
  color: #666;
}

.form-group {
  margin-bottom: 18px;
}

label {
  font-size: 15px;
  color: #444;
}

input {
  width: 100%;
  padding: 12px;
  margin-top: 6px;
  border: 1px solid #ccc;
  border-radius: 10px;
  font-size: 16px;
}

.hint {
  font-size: 12px;
  color: #999;
  margin-top: 4px;
}

/* Ø²Ø± Ø¥Ø±Ø³Ø§Ù„ */
.main-btn {
  width: 100%;
  padding: 15px;
  background: #00a884;
  color: white;
  font-size: 18px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  margin-top: 10px;
}

.main-btn:hover {
  background: #009873;
}

/* Ø²Ø± Ã— Ù„Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
.clear-btn {
  position: absolute;
  top: 12px;
  left: 12px;
  width: 30px;
  height: 30px;
  border-radius: 999px;
  border: none;
  background: #e5e7eb;
  color: #555;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.clear-btn:hover {
  background: #d1d5db;
}

.log-btn {
  width: 100%;
  padding: 13px;
  margin-top: 14px;
  border-radius: 10px;
  border: 1px solid #00a884;
  background: #f0fdf4;
  color: #047857;
  font-size: 15px;
  cursor: pointer;
}

.log-btn:hover {
  background: #dcfce7;
}

/* ===== Bottom Sheet Ø§Ù„Ø³Ø¬Ù„ ===== */
.sheet-overlay {
  position: fixed;
  inset: 0;
  background: #00000055;
  display: none;
  align-items: flex-end;
  justify-content: center;
  z-index: 50;
}

.sheet-overlay.active {
  display: flex;
}

.sheet {
  width: 100%;
  max-width: 480px;
  background: white;
  border-top-left-radius: 18px;
  border-top-right-radius: 18px;
  padding: 14px 16px 18px;
  box-shadow: 0 -8px 25px #0003;
  max-height: 85vh;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.sheet-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 4px;
}

.sheet-title {
  font-size: 16px;
  font-weight: 700;
  color: #111827;
}

.sheet-close {
  border: none;
  background: #e5e7eb;
  width: 28px;
  height: 28px;
  border-radius: 999px;
  cursor: pointer;
  font-size: 18px;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sheet-close:hover {
  background: #d1d5db;
}

.log-search {
  width: 100%;
  padding: 8px 10px;
  font-size: 14px;
  border-radius: 999px;
  border: 1px solid #ccc;
}

.log-list {
  flex: 1;
  overflow-y: auto;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  padding: 8px;
  background: #fafafa;
}

.log-empty {
  text-align: center;
  font-size: 13px;
  color: #999;
  padding: 10px 0;
}

/* Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø§Øµ */
.bus-group {
  margin-bottom: 10px;
}

.bus-title {
  font-size: 14px;
  font-weight: 700;
  color: #0f172a;
  margin-bottom: 4px;
}

/* Ø¹Ù†ØµØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø¬Ù„ */
.log-item {
  background: white;
  border-radius: 8px;
  padding: 6px 8px;
  margin-bottom: 4px;
  border: 1px solid #e5e7eb;
  font-size: 13px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 6px;
}

.log-item-main {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.log-name {
  font-weight: 600;
  color: #111827;
}

.log-phone {
  color: #4b5563;
  font-size: 12px;
}

.log-time {
  font-size: 11px;
  color: #9ca3af;
}

.log-delete {
  border: none;
  background: #fee2e2;
  color: #b91c1c;
  width: 24px;
  height: 24px;
  border-radius: 999px;
  cursor: pointer;
  font-size: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.log-delete:hover {
  background: #fecaca;
}

/* Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
.clear-log-btn {
  background: #b00020;
  color: #fff;
  padding: 10px 18px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  width: 100%;
  font-size: 14px;
  margin-top: 6px;
}

.clear-log-btn:hover {
  background: #d32f2f;
}

.clear-warning {
  font-size: 11px;
  color: #777;
  margin-top: 4px;
  text-align: center;
}
</style>
</head>

<body>
<div class="container">

  <button id="clearBtn" class="clear-btn" title="Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬">Ã—</button>

  <h1 class="title">ÙˆÙƒØ§Ù„Ø© Ù†ÙˆØ± Ø§Ù„Ù…Ù†ØªØ¸Ø±</h1>
  <p class="subtitle">Ù†Ø¸Ø§Ù… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Øµ Ù„Ù„Ø²ÙˆØ§Ø±</p>

  <div class="form-group">
    <label>Ø§Ø³Ù… Ø§Ù„Ø²Ø§Ø¦Ø±:</label>
    <input type="text" id="name" placeholder="" />
  </div>

  <div class="form-group">
    <label>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Øµ:</label>
    <input type="number" id="bus" placeholder="" />
  </div>

  <div class="form-group">
    <label>Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ø²Ø§Ø¦Ø±:</label>
    <input type="tel" id="phone" placeholder="05xxxxxxxx" />
    <div class="hint">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø³Ø¹ÙˆØ¯ÙŠ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05â€¦</div>
  </div>

  <button id="sendBtn" class="main-btn">Ø¥Ø±Ø³Ø§Ù„</button>
  <button id="openLogBtn" class="log-btn">Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</button>

</div>

<!-- Bottom Sheet Ù„Ù„Ø³Ø¬Ù„ -->
<div class="sheet-overlay" id="logOverlay">
  <div class="sheet">
    <div class="sheet-header">
      <span class="sheet-title">Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</span>
      <button class="sheet-close" id="closeLogBtn">Ã—</button>
    </div>

    <input id="logSearch" class="log-search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø²Ø§Ø¦Ø±..." />

    <div id="logList" class="log-list"></div>

    <button id="clearLogBtn" class="clear-log-btn">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
    <p class="clear-warning">âš ï¸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²</p>
  </div>
</div>

<script>
// ================= Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ®Ø²ÙŠÙ† =================
const LOG_KEY = "noor_buses_log";

function loadLog() {
  try {
    const raw = localStorage.getItem(LOG_KEY);
    const arr = raw ? JSON.parse(raw) : [];
    return Array.isArray(arr) ? arr : [];
  } catch {
    return [];
  }
}

function saveLog(data) {
  localStorage.setItem(LOG_KEY, JSON.stringify(data));
}

function addLog(entry) {
  const log = loadLog();
  log.unshift(entry);
  saveLog(log);
  renderLog();
}

// ================= Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø© =================
const nameInput   = document.getElementById("name");
const busInput    = document.getElementById("bus");
const phoneInput  = document.getElementById("phone");
const sendBtn     = document.getElementById("sendBtn");
const clearBtn    = document.getElementById("clearBtn");

const openLogBtn  = document.getElementById("openLogBtn");
const logOverlay  = document.getElementById("logOverlay");
const closeLogBtn = document.getElementById("closeLogBtn");
const logSearch   = document.getElementById("logSearch");
const logList     = document.getElementById("logList");
const clearLogBtn = document.getElementById("clearLogBtn");

// =============== ØªÙ†Ø³ÙŠÙ‚ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ===============
function normalizePhone(phone) {
  let p = phone.trim().replace(/\s|-|_/g, "");
  if (p.startsWith("+966")) p = "0" + p.slice(4);
  else if (p.startsWith("966")) p = "0" + p.slice(3);
  if (!p.startsWith("05")) return null;
  return "966" + p.slice(1);
}

// =============== Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ ===============
sendBtn.addEventListener("click", () => {
  const name  = nameInput.value.trim();
  const bus   = busInput.value.trim();
  const phone = phoneInput.value.trim();

  if (!name || !bus || !phone) {
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ø²Ø§Ø¦Ø±ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§ØµØŒ ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„.");
    return;
  }

  const intl = normalizePhone(phone);
  if (!intl) {
    alert("ØªØ£ÙƒØ¯ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ø³Ø¹ÙˆØ¯ÙŠ ØµØ­ÙŠØ­ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05.");
    return;
  }

  const msg = `
Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ ğŸŒ¹

ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}
ğŸšŒ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Øµ: ${bus}

Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… Ø±Ø­Ù„Ø© Ù…ÙˆÙÙ‚Ø© Ù…Ø¹ *ÙˆÙƒØ§Ù„Ø© Ù†ÙˆØ± Ø§Ù„Ù…Ù†ØªØ¸Ø±*

ğŸ“² Ø®Ø¯Ù…Ø© MenuLink
  `;

  const waUrl = `https://wa.me/${intl}?text=${encodeURIComponent(msg)}`;
  window.open(waUrl, "_blank");

  const now = new Date();
  const timeStr = now.toLocaleString("ar-SA", {
    dateStyle: "short",
    timeStyle: "short"
  });

  addLog({
    id: now.getTime(),
    name,
    bus,
    phone,
    time: timeStr
  });

  clearForm();
});

// =============== ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ===============
function clearForm() {
  nameInput.value = "";
  busInput.value = "";
  phoneInput.value = "";
  nameInput.focus();
}

clearBtn.addEventListener("click", clearForm);

// =============== Ø±Ø³Ù… Ø§Ù„Ø³Ø¬Ù„ ===============
function renderLog() {
  const log = loadLog();
  const q = logSearch.value.trim().toLowerCase();

  let filtered = log;
  if (q) {
    filtered = log.filter(item =>
      (item.name || "").toLowerCase().includes(q)
    );
  }

  logList.innerHTML = "";

  if (!filtered.length) {
    logList.innerHTML = `<div class="log-empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>`;
    return;
  }

  // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Øµ
  filtered.sort((a, b) => {
    const ba = parseInt(a.bus || "0", 10);
    const bb = parseInt(b.bus || "0", 10);
    return ba - bb;
  });

  // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Øµ
  const groups = {};
  filtered.forEach((item) => {
    const key = item.bus || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    if (!groups[key]) groups[key] = [];
    groups[key].push(item);
  });

  Object.keys(groups).forEach(busNo => {
    const groupEl = document.createElement("div");
    groupEl.className = "bus-group";

    const titleEl = document.createElement("div");
    titleEl.className = "bus-title";
    titleEl.textContent = `Ø¨Ø§Øµ ${busNo}`;
    groupEl.appendChild(titleEl);

    groups[busNo].forEach(item => {
      const row = document.createElement("div");
      row.className = "log-item";

      const mainBox = document.createElement("div");
      mainBox.className = "log-item-main";

      const nameEl = document.createElement("div");
      nameEl.className = "log-name";
      nameEl.textContent = item.name || "";

      const phoneEl = document.createElement("div");
      phoneEl.className = "log-phone";
      phoneEl.textContent = `Ø¬ÙˆØ§Ù„: ${item.phone || ""}`;

      const timeEl = document.createElement("div");
      timeEl.className = "log-time";
      timeEl.textContent = item.time || "";

      mainBox.appendChild(nameEl);
      mainBox.appendChild(phoneEl);
      mainBox.appendChild(timeEl);

      const delBtn = document.createElement("button");
      delBtn.className = "log-delete";
      delBtn.textContent = "Ã—";
      delBtn.title = "Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„";
      delBtn.addEventListener("click", () => {
        deleteLogItem(item.id);
      });

      row.appendChild(mainBox);
      row.appendChild(delBtn);

      groupEl.appendChild(row);
    });

    logList.appendChild(groupEl);
  });
}

// Ø­Ø°Ù Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„
function deleteLogItem(id) {
  const log = loadLog();
  const newLog = log.filter(item => item.id !== id);
  saveLog(newLog);
  renderLog();
}

// =============== Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ===============
clearLogBtn.addEventListener("click", () => {
  const ok = confirm("Ù…ØªØ£ÙƒØ¯ ØªØ¨ÙŠ ØªØ­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ ÙƒØ§Ù…Ù„ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŸ");
  if (!ok) return;
  saveLog([]);
  renderLog();
  alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ âœ”ï¸");
});

// =============== ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³Ø¬Ù„ ===============
openLogBtn.addEventListener("click", () => {
  logOverlay.classList.add("active");
  renderLog();
});

closeLogBtn.addEventListener("click", () => {
  logOverlay.classList.remove("active");
});

logOverlay.addEventListener("click", (e) => {
  if (e.target === logOverlay) {
    logOverlay.classList.remove("active");
  }
});

// Ø§Ù„Ø¨Ø­Ø«
logSearch.addEventListener("input", renderLog);
</script>

</body>
</html>
