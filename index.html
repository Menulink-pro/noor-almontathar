<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ÙˆÙƒØ§Ù„Ø© Ù†ÙˆØ± Ø§Ù„Ù…Ù†ØªØ¸Ø± - Ø¥Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Øµ</title>

<style>
body {
  margin: 0;
  padding: 0;
  background: #f2f4f7;
  font-family: "Tajawal", sans-serif;
}

.container {
  width: 90%;
  max-width: 430px;
  margin: 35px auto;
  background: white;
  padding: 25px;
  border-radius: 16px;
  box-shadow: 0 0 20px #0001;
}

.title {
  text-align: center;
  font-size: 24px;
  margin-bottom: 5px;
  color: #333;
}

.subtitle {
  text-align: center;
  font-size: 14px;
  margin-bottom: 25px;
  color: #666;
}

.form-group {
  margin-bottom: 18px;
}

label {
  font-size: 15px;
  color: #444;
}

input {
  width: 100%;
  padding: 12px;
  margin-top: 6px;
  border: 1px solid #ccc;
  border-radius: 10px;
  font-size: 16px;
}

.hint {
  font-size: 12px;
  color: #999;
  margin-top: 4px;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.main-btn {
  width: 100%;
  padding: 15px;
  background: #00a884;
  color: white;
  font-size: 18px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  margin-top: 10px;
}

.main-btn:hover {
  background: #009873;
}

.clear-btn {
  width: 100%;
  padding: 14px;
  background: #d9534f;
  color: white;
  font-size: 16px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  margin-top: 12px;
}

.clear-btn:hover {
  background: #c64541;
}

.divider {
  margin: 25px 0 15px;
  border: none;
  border-top: 1px solid #e5e7eb;
}

/* Ø§Ù„Ø³Ø¬Ù„ */
.log-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.log-title {
  font-size: 15px;
  font-weight: 600;
  color: #333;
}

.log-search {
  flex: 1;
  padding: 8px 10px;
  font-size: 14px;
  border-radius: 999px;
  border: 1px solid #ccc;
}

.log-list {
  max-height: 260px;
  overflow-y: auto;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  padding: 8px;
  background: #fafafa;
}

.log-empty {
  text-align: center;
  font-size: 13px;
  color: #999;
  padding: 10px 0;
}

.log-item {
  background: white;
  border-radius: 8px;
  padding: 8px 10px;
  margin-bottom: 6px;
  border: 1px solid #e5e7eb;
  font-size: 13px;
}

.log-item-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 3px;
  font-weight: 600;
  color: #111827;
}

.log-item-body {
  display: flex;
  justify-content: space-between;
  color: #4b5563;
  margin-bottom: 2px;
}

.log-item-time {
  font-size: 11px;
  color: #9ca3af;
  text-align: left;
}

/* ØµÙ†Ø¯ÙˆÙ‚ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ */
.delete-log-box {
  margin-top: 14px;
  text-align: center;
}

.clear-log-btn {
  background: #b00020;
  color: #fff;
  padding: 10px 18px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  width: 90%;
  font-size: 14px;
  transition: 0.2s;
}

.clear-log-btn:hover {
  background: #d32f2f;
}

.clear-warning {
  font-size: 11px;
  color: #777;
  margin-top: 4px;
}
</style>
</head>

<body>
<div class="container">

  <h1 class="title">ÙˆÙƒØ§Ù„Ø© Ù†ÙˆØ± Ø§Ù„Ù…Ù†ØªØ¸Ø±</h1>
  <p class="subtitle">Ù†Ø¸Ø§Ù… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Øµ Ù„Ù„Ø²ÙˆØ§Ø±</p>

  <div class="form-group">
    <label>Ø§Ø³Ù… Ø§Ù„Ø²Ø§Ø¦Ø±:</label>
    <input type="text" id="name" placeholder="Ù…Ø«Ø§Ù„: Ø¬Ø¹ÙØ± Ø¹Ù„ÙŠ" />
  </div>

  <div class="form-group">
    <label>Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Øµ:</label>
    <input type="number" id="bus" placeholder="Ù…Ø«Ø§Ù„: 1" />
  </div>

  <div class="form-group">
    <label>Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ø²Ø§Ø¦Ø±:</label>
    <input type="tel" id="phone" placeholder="05xxxxxxxx" />
    <div class="hint">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø³Ø¹ÙˆØ¯ÙŠ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05â€¦</div>
  </div>

  <button id="sendBtn" class="main-btn">Ø¥Ø±Ø³Ø§Ù„</button>
  <button id="clearBtn" class="clear-btn">Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>

  <hr class="divider" />

  <div class="log-header">
    <span class="log-title">Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</span>
    <input id="logSearch" class="log-search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø²Ø§Ø¦Ø±..." />
  </div>

  <div id="logList" class="log-list"></div>

  <div class="delete-log-box">
    <button id="clearLogBtn" class="clear-log-btn">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
    <p class="clear-warning">âš ï¸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²</p>
  </div>

</div>

<script>
// ============= Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ =============
const LOG_KEY = "noor_buses_log";

function loadLog() {
  try {
    const raw = localStorage.getItem(LOG_KEY);
    return raw ? JSON.parse(raw) : [];
  } catch {
    return [];
  }
}

function saveLog(data) {
  localStorage.setItem(LOG_KEY, JSON.stringify(data));
}

function addLog(entry) {
  const log = loadLog();
  log.unshift(entry); // Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„ ÙˆØ§Ø­Ø¯
  saveLog(log);
  renderLog();
}

// ============= Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø© =============
const nameInput   = document.getElementById("name");
const busInput    = document.getElementById("bus");
const phoneInput  = document.getElementById("phone");
const sendBtn     = document.getElementById("sendBtn");
const clearBtn    = document.getElementById("clearBtn");
const logSearch   = document.getElementById("logSearch");
const logList     = document.getElementById("logList");
const clearLogBtn = document.getElementById("clearLogBtn");

// ============= ØªÙ†Ø³ÙŠÙ‚ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ =============
function normalizePhone(phone) {
  let p = phone.trim().replace(/\s|-|_/g, "");

  if (p.startsWith("+966")) {
    p = "0" + p.slice(4);
  } else if (p.startsWith("966")) {
    p = "0" + p.slice(3);
  }

  if (!p.startsWith("05")) return null;

  return "966" + p.slice(1); // 9665xxxxxxx
}

// ============= Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ =============
sendBtn.addEventListener("click", () => {
  const name  = nameInput.value.trim();
  const bus   = busInput.value.trim();
  const phone = phoneInput.value.trim();

  if (!name || !bus || !phone) {
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø§Ø³Ù… Ø§Ù„Ø²Ø§Ø¦Ø±ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§ØµØŒ ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„.");
    return;
  }

  const intl = normalizePhone(phone);
  if (!intl) {
    alert("ØªØ£ÙƒØ¯ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø±Ù‚Ù… Ø³Ø¹ÙˆØ¯ÙŠ ØµØ­ÙŠØ­ ÙŠØ¨Ø¯Ø£ Ø¨Ù€ 05.");
    return;
  }

  const msg = `
Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ ğŸŒ¹

ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}
ğŸšŒ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Øµ: ${bus}

Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… Ø±Ø­Ù„Ø© Ù…ÙˆÙÙ‚Ø© Ù…Ø¹ *ÙˆÙƒØ§Ù„Ø© Ù†ÙˆØ± Ø§Ù„Ù…Ù†ØªØ¸Ø±*

ğŸ“² Ø®Ø¯Ù…Ø© MenuLink
  `;

  const waUrl = `https://wa.me/${intl}?text=${encodeURIComponent(msg)}`;
  window.open(waUrl, "_blank");

  const now = new Date().toLocaleString("ar-SA", {
    dateStyle: "short",
    timeStyle: "short"
  });

  addLog({ name, bus, phone, time: now });

  clearForm();
});

// ============= ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙÙ‚Ø· =============
function clearForm() {
  nameInput.value = "";
  busInput.value = "";
  phoneInput.value = "";
  nameInput.focus();
}

clearBtn.addEventListener("click", clearForm);

// ============= Ø±Ø³Ù… Ø§Ù„Ø³Ø¬Ù„ + Ø§Ù„Ø¨Ø­Ø« =============
function renderLog() {
  const log = loadLog();
  const q = logSearch.value.trim().toLowerCase();

  const filtered = q
    ? log.filter(e => (e.name || "").toLowerCase().includes(q))
    : log;

  logList.innerHTML = "";

  if (!filtered.length) {
    logList.innerHTML = `<div class="log-empty">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</div>`;
    return;
  }

  filtered.forEach(e => {
    const row = document.createElement("div");
    row.className = "log-item";

    const header = document.createElement("div");
    header.className = "log-item-header";
    header.innerHTML = `<span>${e.name}</span><span>Ø¨Ø§Øµ ${e.bus}</span>`;

    const body = document.createElement("div");
    body.className = "log-item-body";
    body.innerHTML = `<span>Ø¬ÙˆØ§Ù„: ${e.phone}</span>`;

    const time = document.createElement("div");
    time.className = "log-item-time";
    time.textContent = e.time || "";

    row.appendChild(header);
    row.appendChild(body);
    row.appendChild(time);

    logList.appendChild(row);
  });
}

logSearch.addEventListener("input", renderLog);

// ============= Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ =============
clearLogBtn.addEventListener("click", () => {
  const ok = confirm("Ù…ØªØ£ÙƒØ¯ ØªØ¨ÙŠ ØªØ­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ ÙƒØ§Ù…Ù„ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŸ");
  if (!ok) return;

  saveLog([]);
  renderLog();
  alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ âœ”ï¸");
});

// Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„ Ù„Ù„Ø³Ø¬Ù„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
renderLog();
</script>

</body>
</html>
